apiVersion: operators.coreos.com/v1alpha1
kind: ClusterServiceVersion
metadata:
  annotations:
    alm-examples: '[]'
    capabilities: Basic Install
    createdAt: "2025-11-04T15:29:44Z"
    operators.operatorframework.io/builder: operator-sdk-v1.34.1
    operators.operatorframework.io/project_layout: go.kubebuilder.io/v4
    repository: https://github.com/mmz-srf/akamai-operator
    support: SRF
  name: akamai-operator.v0.4.1
  namespace: placeholder
spec:
  apiservicedefinitions: {}
  customresourcedefinitions: {}
  description: |
    # Akamai Operator
    
    A Kubernetes operator for managing Akamai Properties through the Property Manager API. This operator is OLM (Operator Lifecycle Manager) compatible and allows you to manage Akamai edge delivery configurations as Kubernetes custom resources.
    
    ## Features
    
    - **Declarative Property Management**: Define Akamai properties as Kubernetes custom resources
    - **Full Lifecycle Management**: Create, update, and delete Akamai properties through Kubernetes
    - **OLM Compatible**: Can be installed and managed through Operator Lifecycle Manager
    - **EdgeGrid Authentication**: Secure authentication using Akamai EdgeGrid
    - **Status Reporting**: Real-time status updates with property versions and deployment state
    - **Rule Configuration**: Support for complex property rules, behaviors, and criteria
    
    ## Prerequisites
    
    - Kubernetes cluster (v1.19+)
    - Akamai API credentials with Property Manager permissions
    - `kubectl` configured to access your cluster
    
    ## Quick Start
    
    ### 1. Install the Operator
    
    #### Option A: Using OLM (Recommended for production)
    
    ```bash
    # Install OLM if not already installed
    curl -sL https://github.com/operator-framework/operator-lifecycle-manager/releases/download/v0.25.0/install.sh | bash -s v0.25.0
    
    # Install the Akamai Operator
    kubectl apply -f https://github.com/mmz-srf/akamai-operator/releases/latest/download/akamai-operator.yaml
    ```
    
    #### Option B: Direct Installation
    
    ```bash
    # Clone the repository
    git clone https://github.com/mmz-srf/akamai-operator.git
    cd akamai-operator
    
    # Install CRDs
    make install
    
    # Deploy the operator
    make deploy
    ```
    
    ### 2. Configure Akamai Credentials
    
    Create a secret with your Akamai API credentials:
    
    ```bash
    kubectl create secret generic akamai-credentials \
      --from-literal=host="akaa-baseurl-xxxxxxxxxxx-xxxxxxxxxxxxx.luna.akamaiapis.net" \
      --from-literal=client_token="akab-xxxxxxxxxxxxxxxx-xxxxxxxxxxxxxxxx" \
      --from-literal=client_secret="xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx" \
      --from-literal=access_token="akab-xxxxxxxxxxxxxxxx-xxxxxxxxxxxxxxxx" \
      --namespace=akamai-operator-system
    ```
    
    **Note:** The operator watches for cluster-scoped `AkamaiProperty` resources across all namespaces, but the operator itself and its credentials are deployed in the `akamai-operator-system` namespace.
    
    ### 3. Create an Akamai Property
    
    Create a sample property configuration:
    
    ```yaml
    apiVersion: akamai.com/v1alpha1
    kind: AkamaiProperty
    metadata:
      name: my-website
    spec:
      propertyName: "my-website.com"
      contractId: "ctr_C-1234567"
      groupId: "grp_12345"
      productId: "prd_Fresca"
      hostnames:
        - cnameFrom: "my-website.com"
          cnameTo: "my-website.com.edgesuite.net"
          certProvisioningType: "CPS_MANAGED"
      rules:
        name: "default"
        behaviors:
          - name: "origin"
            options:
              originType: "CUSTOMER"
              hostname: "origin.my-website.com"
              forwardHostHeader: "REQUEST_HOST_HEADER"
      activation:
        network: "PRODUCTION"
        notifyEmails:
          - "admin@example.com"
    ```
    
    Apply the configuration:
    
    ```bash
    kubectl apply -f my-property.yaml
    ```
    
    ### 4. Monitor the Property
    
    Check the status of your property:
    
    ```bash
    # List all Akamai properties
    kubectl get akamaiproperties
    
    # Get detailed status
    kubectl describe akamaiproperty my-website
    ```
    
    ## Configuration
    
    ### AkamaiProperty Custom Resource
    
    The `AkamaiProperty` custom resource supports the following specifications:
    
    #### Required Fields
    
    - `propertyName`: Name of the Akamai property
    - `contractId`: Akamai contract ID (format: `ctr_C-XXXXXXX`)
    - `groupId`: Akamai group ID (format: `grp_XXXXX`)
    - `productId`: Akamai product ID (e.g., `prd_Fresca`)
    
    #### Optional Fields
    
    - `hostnames`: Array of hostname configurations
    - `rules`: Property rules configuration with behaviors and criteria
    - `edgeHostname`: Edge hostname configuration
    - `activation`: Activation configuration for deploying the property to Akamai networks
    
    ### Hostnames Configuration
    
    ```yaml
    hostnames:
      - cnameFrom: "example.com"
        cnameTo: "example.com.edgesuite.net"
        certProvisioningType: "CPS_MANAGED"
    ```
    
    ### Rules Configuration
    
    The rules system supports nested rules with criteria and behaviors:
    
    ```yaml
    rules:
      name: "default"
      behaviors:
        - name: "origin"
          options:
            originType: "CUSTOMER"
            hostname: "origin.example.com"
      children:
        - name: "Static Assets"
          criteria:
            - name: "fileExtension"
              options:
                matchOperator: "IS_ONE_OF"
                values: ["css", "js", "png"]
          behaviors:
            - name: "caching"
              options:
                behavior: "MAX_AGE"
                ttl: "7d"
    ```
    
    ### Activation Configuration
    
    The operator supports automatic activation of properties to Akamai's staging and production networks:
    
    ```yaml
    activation:
      # Target network: STAGING or PRODUCTION
      network: "STAGING"
      # Email addresses to notify when activation status changes
      notifyEmails:
        - "admin@example.com"
        - "devops@example.com"
      # Descriptive note for the activation
      note: "Automated activation via Kubernetes operator"
      # Skip acknowledging individual warnings (default: false)
      acknowledgeAllWarnings: true
      # Enable fast metadata push (default: true)
      fastPush: true
      # Ignore HTTP errors during fast metadata push (default: true)
      ignoreHttpErrors: true
      # Use fast fallback for quick rollback within 1 hour (default: false)
      useFastFallback: false
    ```
    
    **Activation Process:**
    
    1. **Automatic Activation**: When an `activation` section is specified, the operator will automatically activate new property versions
    2. **Status Tracking**: The operator tracks activation status and updates the resource status accordingly
    3. **Network Support**: Supports both `STAGING` and `PRODUCTION` networks
    4. **Notifications**: Email notifications are sent based on the `notifyEmails` configuration
    5. **Rollback Support**: Fast fallback can be enabled for quick rollback within one hour of activation
    
    **Activation Status Fields:**
    
    The operator provides detailed activation status in the resource status:
    
    - `stagingVersion`: Currently active version on staging
    - `productionVersion`: Currently active version on production  
    - `stagingActivationId`: ID of the current staging activation
    - `productionActivationId`: ID of the current production activation
    - `stagingActivationStatus`: Status of staging activation (PENDING, ACTIVE, FAILED)
    - `productionActivationStatus`: Status of production activation (PENDING, ACTIVE, FAILED)
    
    ## Authentication
    
    The operator uses Akamai EdgeGrid authentication. You need to provide the following credentials:
    
    1. **Host**: Your API endpoint hostname
    2. **Client Token**: Your client token
    3. **Client Secret**: Your client secret  
    4. **Access Token**: Your access token
    
    These can be obtained from the Akamai Control Center under "Identity & Access Management" > "API User".
    
    ## Examples
    
    ### Basic Website Property
    
    ```yaml
    apiVersion: akamai.com/v1alpha1
    kind: AkamaiProperty
    metadata:
      name: basic-website
    spec:
      propertyName: "basic-website.com"
      contractId: "ctr_C-1234567"
      groupId: "grp_12345"
      productId: "prd_Fresca"
      hostnames:
        - cnameFrom: "basic-website.com"
          cnameTo: "basic-website.com.edgesuite.net"
      rules:
        name: "default"
        behaviors:
          - name: "origin"
            options:
              originType: "CUSTOMER"
              hostname: "origin.basic-website.com"
      activation:
        network: "PRODUCTION"
        notifyEmails:
          - "admin@example.com"
    ```
    
    ### Advanced Property with Multiple Rules
    
    See [config/samples/akamai_v1alpha1_akamaiproperty.yaml](config/samples/akamai_v1alpha1_akamaiproperty.yaml) for a comprehensive example.
    
    ## Monitoring and Troubleshooting
    
    ### Check Operator Logs
    
    ```bash
    kubectl logs -n akamai-operator-system deployment/akamai-operator-controller-manager
    ```
    
    ### Property Status
    
    The operator reports detailed status information:
    
    ```yaml
    status:
      propertyId: "prp_123456"
      latestVersion: 2
      stagingVersion: 1
      productionVersion: 1
      phase: "Ready"
      conditions:
        - type: "Ready"
          status: "True"
          reason: "PropertyReady"
          message: "Property is ready"
    ```
    
    ### Common Issues
    
    1. **Authentication Errors**: Verify your API credentials are correct
    2. **Contract/Group Not Found**: Ensure the contract and group IDs are valid
    3. **Property Creation Failed**: Check the operator logs for detailed error messages
    
    ## Development
    
    ### Building from Source
    
    ```bash
    # Clone the repository
    git clone https://github.com/mmz-srf/akamai-operator.git
    cd akamai-operator
    
    # Build the operator
    make build
    
    # Run tests
    make test
    
    # Build Docker image
    make docker-build IMG=your-registry/akamai-operator:latest
    ```
    
    ### Local Development
    
    ```bash
    # Install CRDs
    make install
    
    # Run the operator locally
    make run
    ```
    
    ## Contributing
    
    We welcome contributions! Please see [CONTRIBUTING.md](CONTRIBUTING.md) for guidelines.
    
    ## License
    
    This project is licensed under the Apache License 2.0. See [LICENSE](LICENSE) for details.
    
    ## Support
    
    For support questions, please:
    
    1. Check the [troubleshooting guide](#monitoring-and-troubleshooting)
    2. Review [existing issues](https://github.com/mmz-srf/akamai-operator/issues)
    3. Create a new issue with detailed information
    
    For Akamai API questions, consult the [Property Manager API documentation](https://techdocs.akamai.com/property-mgr/reference/post-properties).
    
    ## Roadmap
    
    - [ ] Support for property activation/deactivation
    - [ ] Bulk property operations
    - [ ] Advanced rule validation
    - [ ] Integration with GitOps workflows
    - [ ] Property backup and restore functionality
    - [ ] Webhook support for property changes
    Manager API
  displayName: Akamai Operator
  icon:
  - base64data: PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2NCIgaGVpZ2h0PSI2NCI+PHBhdGggZD0iTTUwLjEyNSA0Ni44NjZoLTYuMDQ3TDQ5LjYyIDM1Ljc4em0uNTA0IDUuMDRsLjUwNCA0LjUzNWg3LjA1NWwtMi41Mi0yNS43SDQ1LjA4NWwtMTMuMTAyIDI1LjdoNy4wNTVsMi4wMTYtNC41MzV6IiBmaWxsPSIjZjc5NzFkIi8+PHBhdGggZD0iTTM1LjAwNyA2Mi40ODhDMjEuOTA0IDU4LjQ1NyAxMi4zMyA0Ni4zNjIgMTIuMzMgMzIuMjUyYzAtMTQuNjE0IDkuNTc1LTI2LjcgMjMuMTgtMzAuNzRDMzcuMDIyIDEuMDA4IDM2LjUxOCAwIDM1LjAwNyAwIDE2Ljg2NS41MDQgMi43NTUgMTQuNjE0IDIuNzU1IDMyLjI1MlMxNi44NjUgNjQgMzUuMDA3IDY0YzEuNTEyIDAgMS41MTItMS4wMDggMC0xLjUxMnptLTE2LjYzLTIzLjE4di0yLjUyYzAtMTQuMSAxMS4wODctMjUuMTk3IDI1LjE5Ny0yNS4xOTcgMTMuMTAyIDAgMTcuMTM0IDYuMDQ3IDE3LjYzOCA1LjU0M1M1Ni42NzYgNS4wNCA0MS4wNTQgNS4wNGMtMTQuMSAwLTI1LjE5NyAxMS4wODctMjUuMTk3IDI1LjE5NyAwIDMuMDI0LjUwNCA2LjA0NyAxLjUxMiA5LjA3LjUwNCAxLjUxMiAxLjAwOCAxLjUxMiAxLjAwOCAwek0yOC45NiAyMS4xNjVjNi41NS0zLjAyNCAxNC42MTQtMy4wMjQgMjIuNjc3IDAgNS41NDMgMi4wMTYgOC41NjcgNC41MzUgOS4wNyA0LjUzNXMtMy4wMjQtNi4wNDctOS41NzUtOC41NjdjLTguMDYyLTMuMDMzLTE2LjEyNS0xLjUtMjIuNjc3IDMuNTI3LS41MDQuNTA0IDAgMS4wMDguNTA0LjUwNHoiIGZpbGw9IiMwMDk1ZDYiLz48L3N2Zz4=
    mediatype: image/svg+xml
  install:
    spec:
      deployments: []
    strategy: deployment
  installModes:
  - supported: false
    type: OwnNamespace
  - supported: false
    type: SingleNamespace
  - supported: false
    type: MultiNamespace
  - supported: true
    type: AllNamespaces
  keywords:
  - akamai
  - cdn
  - edge
  - property
  - manager
  links:
  - name: Akamai Operator
    url: https://github.com/mmz-srf/akamai-operator
  - name: Akamai Property Manager API
    url: https://techdocs.akamai.com/property-mgr/reference/api
  maintainers:
  - email: gicara@gmail.com
    name: Gianni Carafa
  maturity: alpha
  provider:
    name: Akamai Technologies
    url: https://www.akamai.com
  version: 0.4.1
